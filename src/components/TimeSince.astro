---
const { date } = Astro.props;
const uniqueId = `time-since-${Math.random().toString(36).substring(2, 9)}`;
---

<span id={uniqueId} data-date={date.getTime()}></span>

<script define:vars={{ uniqueId, dateMS: date.getTime() }}>
    const currentTimeMS = Math.floor(new Date().getTime());

    let interval = 1; // ms
    let msElapsed = 0;

    function updateTimeSince() {
        let years = roundToDp(
            (currentTimeMS - dateMS + msElapsed) / (60 * 60 * 24 * 365.25 * 1000),
            2
        );
        let milliseconds = currentTimeMS - dateMS + msElapsed;

        const element = document.getElementById(uniqueId);
        if (element) {
            element.innerText = `${years}y or ${milliseconds}ms`;
        }
    }

    function roundToDp(num, dp) {
        const factor = Math.pow(10, dp);
        return Math.floor(num * factor) / factor;
    }

    updateTimeSince();

    setInterval(() => {
        msElapsed += interval;
        updateTimeSince();
    }, interval);
</script>
